<tool id="poretools_fastx" name="fast5-to-fastX" version="@TOOL_VERSION@-g0.3">
    <description>convert fast5 to fasta/fastq</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="version_command" />
    <command detect_errors="aggressive"><![CDATA[
ln -s '$fast5in' '${fast5in.name}' &&

poretools $output_format
'${fast5in.name}'
--type $advanced.type
#if $advanced.min_length
    --min-length $advanced.min_length
#end if
#if $advanced.max_length
    --max-length $advanced.max_length
#end if
#if $advanced.start
    --start $advanced.start
#end if
#if $advanced.end
    --end $advanced.end
#end if
$advanced.high_quality
$advanced.normal_quality
#if $advanced.group
    --group '$advanced.group'
#end if
> '$fastx_out'
    ]]></command>
    <inputs>
        <param name="fast5in" type="data" format="h5" label="Fast5 files" />
        <param name="output_format" type="select" label="Select output format" >
            <option value="fastq">Fastq</option>
            <option value="fasta">Fasta</option>
        </param>
        <section name="advanced" title="Advanced settings">
            <param argument="--type" type="select" multiple="false" label="Which type of FASTQ entries should be reported?">
                <option value="all" selected="true">all</option>
                <option value="fwd">fwd</option>
                <option value="rev">rev</option>
                <option value="2D">2D</option>
                <option value="fwd,rev">fwd,rev</option>
                <option value="best">best</option>
            </param>
            <param argument="--min_length" type="integer" optional="true" value="" min="0" label="Minimum read length for FASTA entry to be reported"/>
            <param argument="--max_length" type="integer" optional="true" value="" min="0" label="Minimum read length for FASTA entry to be reported"/>
            <param argument="--high_quality" type="boolean" truevalue="--high-quality" falsevalue="" checked="false"
                   label="High quality?" help="Only report reads with more complement events than template?"/>
            <param argument="--normal_quality" type="boolean" truevalue="--normal-quality" falsevalue="" checked="false"
                   label="Normal quality?" help="Only report reads with fewer complement events than template?"/>
            <param argument="--group" type="text" value="000" label="Group" help="Base calling group serial number to extract. Default 000"/>
            <param argument="--start" type="integer" value="" min="0" optional="true" label="START_TIME" help="Only report reads from after start timestamp"/>
            <param argument="--end" type="integer" value="" min="0" optional="true" label="END_TIME" help="Only report reads from before start timestamp"/>
        </section>
    </inputs>
    <outputs>
        <data name="fastx_out" format="fastq" label="${tool.name} on ${on_string}: ${output_format}">
            <change_format>
                <when input="output_format" value="fasta" format="fasta"/>
            </change_format>
        </data>
    </outputs>
    <tests>
        <test><!-- test conversion to fastq -->
            <param name="fast5in" value="test.fast5"/>
            <output name="fastx_out" file="test.fastq" ftype="fastq" lines_diff="6"/>
        </test>
        <test><!-- test conversion to fasta -->
            <param name="fast5in" value="test.fast5"/>
            <param name="output_format" value="fasta"/>
            <output name="fastx_out" file="test.fasta" ftype="fasta"/>
        </test>
        <test><!-- test with additional parameters -->
            <param name="fast5in" value="test.fast5"/>
            <param name="min_length" value="230"/>
            <param name="normal_quality" value="--normal-quality"/>
            <output name="fastx_out" md5="a2ca3da849d1dfa42831c4424f2fbc19" ftype="fastq"/>
        </test>
        <test><!-- test with timestamp param and empty group param -->
            <param name="fast5in" value="test.fast5"/>
            <param name="start" value="1487197016"/>
            <param name="group" value=""/>
            <output name="fastx_out" md5="d41d8cd98f00b204e9800998ecf8427e" ftype="fastq"/>
        </test>
    </tests>
    <help><![CDATA[
@HELP_GENERAL@

**Command Documentation**

Extract sequences in FASTQ/FASTA format from a set of FAST5 files.

For more information about this command, see command_doc_ and command_doc2_

.. _command_doc: http://poretools.readthedocs.io/en/latest/content/examples.html#poretools-fastq
.. _command_doc2: http://poretools.readthedocs.io/en/latest/content/examples.html#poretools-fastq2
    ]]></help>
    <expand macro="citations"/>
</tool>
