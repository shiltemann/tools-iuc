<tool id="poretools_yield_plot" name="yield plot" version="@TOOL_VERSION@.0">
    <description>create collector's curves</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="version_command" />
    <command detect_errors="aggressive"><![CDATA[
## set matplotlib backend
export MPLBACKEND="Agg" &&

mkdir fast5files &&

#for $f in $fast5in
    ln -s '$f' 'fast5files/${f.name}' &&
#end for

poretools yield_plot
--plot-type $plot_type
--saveas 'output.$output_format'
$theme_bw
#if $savedf
    --savedf $dataframe
#end if
fast5files/
    ]]></command>
    <inputs>
        <param name="fast5in" type="data" format="h5" multiple="true" label="Fast5 files" />
        <param name="plot_type" argument="--plot-type" type="select" label="Plot type" >
            <option value="reads" selected="true">reads</option>
            <option value="basepairs">basepairs</option>
        </param>
        <expand macro="output_format_param" />
        <expand macro="theme_bw_param" />
        <param argument="--savedf" type="boolean" truevalue="--savedf" falsevalue="" label="Save the data frame used to construct plot" />
    </inputs>
    <outputs>
        <data name="plot_out_png" format="png" from_work_dir="output.png" label="${tool.name} on ${on_string}: plot (png)" >
            <filter> output_format == 'png' </filter>
        </data>
        <data name="plot_out_pdf" format="pdf" from_work_dir="output.pdf" label="${tool.name} on ${on_string}: plot (pdf)" >
            <filter> output_format == 'pdf' </filter>
        </data>
        <data name="dataframe" format="txt" label="${tool.name} on ${on_string}: data frame">
            <filter> savedf </filter>
        </data>
    </outputs>
    <tests>
        <test><!-- test with defaults -->
            <param name="fast5in" value="test.fast5,test2.fast5"/>
            <output name="plot_out_png" file="plot.png" ftype="png" compare="sim_size" />
        </test>
        <test><!-- test with custom settings -->
            <param name="fast5in" value="test.fast5,test2.fast5"/>
            <param name="plot_type" value="basepairs" />
            <param name="output_format" value="pdf" />
            <param name="theme_bw" value="--theme-bw" />
            <param name="savedf" value="--savedf" />
            <output name="plot_out_pdf" file="plot.pdf" ftype="pdf" compare="sim_size" />
            <output name="dataframe" file="frame.txt" ftype="txt" />
        </test>
    </tests>
    <help><![CDATA[
@HELP_GENERAL@

**Command Documentation**

Create a collectorâ€™s curve reflecting the sequencing yield over time for a set of reads.

For more information about this command, see command_doc_

.. _command_doc: http://poretools.readthedocs.io/en/latest/content/examples.html#poretools-yield-plot

    ]]></help>
    <expand macro="citations"/>
</tool>
