<tool id="qiime_summarize_taxa_through_plots" name="Perform taxonomy" version="1.9.1">
    <description>summaries and plots</description>
    
    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements" />

    <version_command><![CDATA[
        summarize_taxa_through_plots.py --version
    ]]>
    </version_command>

    <command>
<![CDATA[
        summarize_taxa_through_plots.py 
            -i $otu_table_fp 
            -o summarize_taxa_through_plots

            #if str($mapping_fp) != 'None':
                -m $mapping_fp
            #end if

            #if str($mapping_category):
                -c $mapping_category
            #end if

            $sort
        
        &&

        mkdir -p $area_charts_html_report.files_path 
        &&
        cp -r summarize_taxa_through_plots/area_charts.html $area_charts_html_report.files_path  
        &&
        cp -r summarize_taxa_through_plots/charts $area_charts_html_report.files_path  
        &&
        cp -r summarize_taxa_through_plots/css $area_charts_html_report.files_path  
        &&
        cp -r summarize_taxa_through_plots/js $area_charts_html_report.files_path  
        && 
        mv $area_charts_html_report.files_path/area_charts.html $area_charts_html_report
    
        &&
        mkdir -p $bar_charts_html_report.files_path 
        &&
        cp -r summarize_taxa_through_plots/bar_charts.html $bar_charts_html_report.files_path  
        &&
        cp -r summarize_taxa_through_plots/charts $bar_charts_html_report.files_path  
        &&
        cp -r summarize_taxa_through_plots/css $bar_charts_html_report.files_path  
        &&
        cp -r summarize_taxa_through_plots/js $bar_charts_html_report.files_path  
        && 
        mv $bar_charts_html_report.files_path/bar_charts.html $bar_charts_html_report
        
]]>
    </command>

    <inputs>
        <param name="otu_table_fp" type="data" format="biom,tabular" 
            label="Input OTU table" help="(-i/--otu_table_fp)"/> 

        <param name="mapping" type="data" format="tabular,tsv,csv" 
            label="Input metadata mapping (optional)" help="(-m, --mapping_fp)" 
            optional="True"/>

        <param default="None" label="-c/--mapping_category: Summarize OTU table 
            using this category. [default: None]" name="mapping_category" 
            optional="True" type="text"/>

        <param name="mapping_category" type="text" value="" label="Category to 
            use to summarize OTU table"  help="(-c/--mapping_category)" 
            optional="True"/>

        <param name="sort" type="boolean" label="Sort OTU table?" 
            truevalue="--sort" falsevalue="" selected="False" 
            help="(-s/--sort)" />
    </inputs>

    <outputs>
        <data name="L1_tab" format="tabular" from_work_dir="summarize_taxa/*_L1.txt" 
            label="${tool.name} on ${on_string}: L1 tab">
            <filter>"1" in level and suppress_classic_table_output is False</filter>
        </data> 

        <data name="L1_biom" format="biom" from_work_dir="summarize_taxa/*_L1.biom" 
            label="${tool.name} on ${on_string}: L1 biom">
            <filter>"1" in level and suppress_biom_table_output is False</filter>
        </data>

        <data name="L2_tab" format="tabular" from_work_dir="summarize_taxa/*_L2.txt" 
            label="${tool.name} on ${on_string}: L2 tab">
            <filter>"2" in level and suppress_classic_table_output is False</filter>
        </data> 

        <data name="L2_biom" format="biom" from_work_dir="summarize_taxa/*_L2.biom" 
            label="${tool.name} on ${on_string}: L2 biom">
            <filter>"2" in level and suppress_biom_table_output is False</filter>
        </data>

        <data name="L3_tab" format="tabular" from_work_dir="summarize_taxa/*_L3.txt" 
            label="${tool.name} on ${on_string}: L3 tab">
            <filter>"3" in level and suppress_classic_table_output is False</filter>
        </data> 

        <data name="L3_biom" format="biom" from_work_dir="summarize_taxa/*_L3.biom" 
            label="${tool.name} on ${on_string}: L3 biom">
            <filter>"3" in level and suppress_biom_table_output is False</filter>
        </data>

        <data name="L4_tab" format="tabular" from_work_dir="summarize_taxa/*_L4.txt" 
            label="${tool.name} on ${on_string}: L4 tab">
            <filter>"4" in level and suppress_classic_table_output is False</filter>
        </data> 

        <data name="L4_biom" format="biom" from_work_dir="summarize_taxa/*_L4.biom" 
            label="${tool.name} on ${on_string}: L4 biom">
            <filter>"4" in level and suppress_biom_table_output is False</filter>
        </data>

        <data name="L5_tab" format="tabular" from_work_dir="summarize_taxa/*_L5.txt" 
            label="${tool.name} on ${on_string}: L5 tab">
            <filter>"5" in level and suppress_classic_table_output is False</filter>
        </data> 

        <data name="L5_biom" format="biom" from_work_dir="summarize_taxa/*_L5.biom" 
            label="${tool.name} on ${on_string}: L5 biom">
            <filter>"5" in level and suppress_biom_table_output is False</filter>
        </data>

        <data name="L6_tab" format="tabular" from_work_dir="summarize_taxa/*_L6.txt" 
            label="${tool.name} on ${on_string}: L6 tab">
            <filter>"6" in level and suppress_classic_table_output is False</filter>
        </data> 

        <data name="L6_biom" format="biom" from_work_dir="summarize_taxa/*_L6.biom" 
            label="${tool.name} on ${on_string}: L6 biom">
            <filter>"6" in level and suppress_biom_table_output is False</filter>
        </data>

        <data name="L7_tab" format="tabular" from_work_dir="summarize_taxa/*_L7.txt" 
            label="${tool.name} on ${on_string}: L7 tab">
            <filter>"7" in level and suppress_classic_table_output is False</filter>
        </data> 

        <data name="L7_biom" format="biom" from_work_dir="summarize_taxa/*_L7.biom" 
            label="${tool.name} on ${on_string}: L7 biom">
            <filter>"7" in level and suppress_biom_table_output is False</filter>
        </data>

        <data name="bar_charts_html_report" format="html" 
            label="${tool.name} on ${on_string}: Bar charts">
            <filter>'bar' is chart_type</filter>
        </data>

        <data name="area_charts_html_report" format="html" 
            label="${tool.name} on ${on_string}: Area charts">
            <filter>'area' is chart_type</filter>
        </data>
    </outputs>

    <tests>
        <test>
        </test>
    </tests>

    <help><![CDATA[
**What it does**

This tool summarizes OTU by Category (optional), summarizes taxonomy and plots
taxonomy summary.

More information about this tool is available on 
`QIIME documentation <http://qiime.org/scripts/summarize_taxa_through_plots.html>`_.
]]>
    </help>

    <citations>
        <expand macro="citations" />
    </citations>

</tool>
