<tool id="qiime_beta_diversity" name="Calculate beta diversity" version="1.9.1">

    <description>(pairwise sample dissimilarity)</description>

    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements" />

    <version_command><![CDATA[
        beta_diversity.py --version
    ]]>
    </version_command>

    <stdio>
        <regex match="VisibleDeprecationWarning"
               source="both"
               level="warning"
               description="VisibleDeprecationWarning on numpy for `rank`" />
    </stdio>

    <command>
<![CDATA[
        #set $chosen_metrics = str( $metrics ).split( "," )

        beta_diversity.py 
            -i $otu_table_fp 

            #if $rows
                -r $rows 
            #end if

            -o beta_diversity
            -m $metrics

            #if "unifrac_g" in $chosen_metrics or "unifrac_g_full_tree" in $chosen_metrics or "unweighted_unifrac" in $chosen_metrics or "unweighted_unifrac_full_tree" in $chosen_metrics or "weighted_normalized_unifrac" in $chosen_metrics or "weighted_unifrac" in $chosen_metrics
                -t $tree_file
            #end if
]]>
    </command>

    <inputs>
        <param name="otu_table_fp" type="data" format="tabular,txt,tsv" 
            label="OTU table" help="(-i/--otu_table_fp)" />

        <param name="rows" type="text" value="" 
            label="Rows on which distance matrix is computed (optional)" help="A 
            comma-separated list of sample names is expected (-i/--otu_table_fp)" 
            optional="true"/>

        <param name="metrics" type="select" multiple="True" label="Beta-diversity 
            metric(s) to use" help="(-m/--metrics)" 
            display="checkboxes">
            <option value="abund_jaccard">Abundance weighted Jaccard distance</option>
            <option value="binary_chisq">Binary chi-square distance</option>
            <option value="binary_chord">Binary chord distance</option>
            <option value="binary_euclidean">Binary euclidean distance</option>
            <option value="binary_hamming">Binary Hamming distance (binary Manhattan distance)</option>
            <option value="binary_jaccard">Binary Jaccard distance (binary Soergel distance)</option>
            <option value="binary_lennon">Binary Lennon distance</option>
            <option value="binary_ochiai">Binary Ochiai distance</option>
            <option value="binary_pearson">Binary Pearson distance</option>
            <option value="binary_sorensen_dice">Binary Sörensen-Dice distance (binary Bray-Curtis distance or binary Whittaker distance)</option>
            <option value="bray_curtis">Bray-Curtis distance (normalized Manhattan distance)</option>
            <option value="canberra">Canberra distance</option>
            <option value="chisq">Chi-square distance</option>
            <option value="chord">Chord distance</option>
            <option value="euclidean">Euclidean distance</option>
            <option value="gower">Gower distance</option>
            <option value="hellinger">Hellinger distance</option>
            <option value="kulczynski">Kulczynski distance</option>
            <option value="manhattan">Manhattan distance</option>
            <option value="morisita_horn">Morisita-Horn distance</option>
            <option value="pearson">Pearson distance</option>
            <option value="soergel">Soergel distance</option>
            <option value="spearman_approx">Spearman rank distance</option>
            <option value="specprof">Species profile distance</option>
            <option value="unifrac_g">G UniFrac metric (phylogenetic)</option>
            <option value="unifrac_g_full_tree">G UniFrac full tree metric (phylogenetic)</option>
            <option value="unweighted_unifrac" selected="true">Unweighted UniFrac metric (phylogenetic)</option>
            <option value="unweighted_unifrac_full_tree">Unweighted UniFrac full tree metric (phylogenetic)</option>
            <option value="weighted_normalized_unifrac">Normalized weighted UniFrac metric (phylogenetic)</option>
            <option value="weighted_unifrac" selected="true">Weighted UniFrac metric (phylogenetic)</option>
        </param>

        <param  name="tree_file" type="data" label="Newick tree (optional, except
            for PD_whole_tree metric" help="(-t/--tree_path)" optional="True"/>
    </inputs>

    <outputs>
        <data format="txt" name="beta_diversity">
            <discover_datasets pattern="__designation__" ext="txt" 
                directory="beta_diversity" visible="true" />
        </data>
    </outputs>

    <tests>
        <test>
        </test>
    </tests>

    <help><![CDATA[

**What it does**

This script generate distance matrices containing a dissimilarity value for each 
pairwise comparison.

A number of metrics are currently supported, including unweighted and weighted UniFrac (pass the -s option to see available metrics). In general, because unifrac uses phylogenetic information, one of the unifrac metrics is recommended, as results can be vastly more useful (Hamady & Knight, 2009). Quantitative measures (e.g. weighted unifrac) are ideally suited to revealing community differences that are due to changes in relative taxon abundance (e.g., when a particular set of taxa flourish because a limiting nutrient source becomes abundant). Qualitative measures (e.g. unweighted unifrac) are most informative when communities differ primarily by what can live in them (e.g., at high temperatures), in part because abundance information can obscure significant patterns of variation in which taxa are present (Lozupone et al., 2007). Most qualitative measures are referred to here e.g. “binary_jaccard”. Typically both weighted and unweighted unifrac are used.

More information about this tool is available on 
`QIIME documentation <http://qiime.org/scripts/beta_diversity.html>`_.
    ]]>
    </help>

    <citations>
        <expand macro="citations" />
    </citations>
</tool>
