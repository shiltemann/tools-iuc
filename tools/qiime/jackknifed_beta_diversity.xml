<tool id="qiime_jackknifed_beta_diversity" name="Perform jackknifed UPGMA 
    clustering" version="1.9.1">

    <description>and building jackknifed PCoA plots</description>

    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements" />

    <version_command><![CDATA[
        jackknifed_beta_diversity.py --version
    ]]>
    </version_command>

    <stdio>
        <regex match="VisibleDeprecationWarning"
               source="both"
               level="warning"
               description="VisibleDeprecationWarning on numpy for `rank`" />
        <regex match="RuntimeWarning: The result contains negative eigenvalues"
               source="both"
               level="warning"
               description="Presence of negative eigenvalues" />
        <regex match="Error"
               source="both"
               level="error"
               description="Error" />
    </stdio>

    <command>
<![CDATA[  
        jackknifed_beta_diversity.py 
            -i $otu_table_fp
            -m $mapping_fp
            -o jackknifed_beta_diversity
            -e $seqs_per_sample

            #if $tree_fp
                -t $tree_fp
            #end if

            #if $parameter_fp
                -p $parameter_fp
            #end if

            --master_tree $master_tree

            $parallel
            -O "\${GALAXY_SLOTS:-4}"
        &&

        python $__tool_directory__/jackknifed_beta_diversity_through_plots_html_generation.py 
            --data_directory jackknifed_beta_diversity
            --html_file $jackknifed_beta_diversity_report
            --html_dir $jackknifed_beta_diversity_report.files_path     

    ]]>
    </command>

    <inputs>
        <param name="otu_table_fp" type="data" format="tabular,txt,tsv,biom" 
            label="OTU table" help="(-i/--otu_table_fp)" 
            multiple="True"/>

        <param name="mapping_fp" type="data" format="tabular,txt,tsv" 
            label="Mapping file" help="(-m/--mapping_fp)" 
            multiple="True"/>

        <param name="seqs_per_sample" type="integer" value="" label="Number of 
            sequences to include in each jackknifed subset" 
            help="(-e/--seqs_per_sample)"/>

        <param name="tree_fp" type="data" format="txt" 
            label="Tree file (Optional)" help="It is required for phylogenetic
            measures (-t/--tree_fp)" 
            optional="True"/>

        <param name="parameter_fp" type="data" format="txt" 
            label="Parameter file (Optional)" help="It specifies changes to the 
            default behavior, e.g. beta diversity metrics (-p/--parameter_fp)" 
            optional="true"/>

        <param name="master_tree" type="select" 
            label="Method for computing master trees in jackknife analysis" 
            help="(--master_tree)">
            <option value="consensus" selected="True">Consensus of trees from jackknifed otu tables</option>
            <option value="full">Tree generated from input (unsubsambled) otu table</option>
        </param>

        <param name="parallel" type="boolean" label="Run in parallel where 
            available?" truevalue="--parallel" falsevalue="" checked="true" 
            help="(-a, --parallel)" />

    </inputs>

    <outputs>
        <data format="html" name="jackknifed_beta_diversity_report" 
            label="${tool.name} on ${on_string}: Report"/>
    </outputs>

    <tests>
        <test>
        </test>
    </tests>

    <help><![CDATA[
**What it does**

This tool performs jackknifing (repeatedly resampling a subset of the available data from each sample) to measure robustness of individual UPGMA clusters and clusters in PCoA plots.

More information about this tool is available on 
`QIIME documentation <http://qiime.org/scripts/jackknifed_beta_diversity.html>`_.
    ]]>
    </help>

    <citations>
        <expand macro="citations" />
    </citations>
</tool>
