<tool id="qiime_alpha_rarefaction" name="Perform alpha rarefaction" version="1.9.1">

    <description></description>

    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements" />

    <version_command><![CDATA[
        alpha_rarefaction.py --version
    ]]>
    </version_command>

    <command>
<![CDATA[        
    alpha_rarefaction.py 
        -i $otu_table_fp 
        -m $mapping_fp
        -o alpha_rarefaction

        #if $parameter_fp
            -p $parameter_fp
        #end if

        -n $num_steps
        $parallel
        -O "\${GALAXY_SLOTS:-4}"

        #if $tree_fp
            -t $tree_fp
        #end if

        --min_rare_depth $min_rare_depth

        #if $max_rare_depth
            -e $max_rare_depth
        #end if

        &&
        mkdir -p $alpha_rarefaction_plots.files_path 
        &&
        cp -r alpha_rarefaction/alpha_rarefaction_plots/rarefaction_plots.html $alpha_rarefaction_plots.files_path  
        &&
        cp -r alpha_rarefaction/alpha_rarefaction_plots/average_plots $alpha_rarefaction_plots.files_path  
        &&
        mv $alpha_rarefaction_plots.files_path/rarefaction_plots.html $alpha_rarefaction_plots
]]>
    </command>

    <inputs>
        <param name="otu_table_fp" type="data" format="tabular,txt,tsv,biom" 
            label="OTU table" help="(-i/--otu_table_fp)" />

        <param name="mapping_fp" type="data" format="tabular,txt,tsv" 
            label="Mapping file" help="(-m/--mapping_fp)" />

        <param name="parameter_fp" type="data" format="txt" 
            label="Parameter file" help="It specifies changes to the default 
            behavior (-p/--parameter_fp)" optional="true"/>

        <param name="num_steps" type="integer" value="10" label="Number of steps 
            (or rarefied OTU table sizes) to make between min and max counts" 
            help="(-n/--num_steps)"/>

        <param name="parallel" type="boolean" label="Run in parallel where 
            available?" truevalue="--parallel" falsevalue="" checked="True" 
            help="(-a, --parallel)" />

        <param name="tree_fp" type="data" format="tabular,txt,tsv" 
            label="Tree file (optional)" help="Required for phylogenetic measures 
            (-t/--tree_fp)" optional="True"/>

        <param name="min_rare_depth" type="integer" value="10" label="Lower limit 
            of rarefaction depths" help="(--min_rare_depth)"/>

        <param name="max_rare_depth" type="integer" label="Upper limit 
            of rarefaction depths" help="By default, median sequence/sample count
            is used (-e/--max_rare_depth)" optional="True"/>
    </inputs>

    <outputs>
        <data name="alpha_rarefaction_plots" format="html" 
            label="${tool.name} on ${on_string}: Alpha rarefaction plots"/>

        <data format="txt" name="alpha_diversity">
            <discover_datasets pattern="__designation__" ext="txt" 
                directory="alpha_rarefaction/alpha_div_collated" visible="true" />
        </data>
    </outputs>

    <tests>
        <test>
        </test>
    </tests>

    <help><![CDATA[

**What it does**

This script performs alpha rarefaction in several steps:

    - Generation of rarefied OTU tables
    - Computation of alpha diversity metrics for each rarefied OTU table
    - Concatenation of alpha diversity results
    - Generation of alpha rarefaction plots

More information about this tool is available on 
`QIIME documentation <http://qiime.org/scripts/alpha_rarefaction.html>`_.
    ]]>
    </help>

    <citations>
        <expand macro="citations" />
    </citations>
</tool>
