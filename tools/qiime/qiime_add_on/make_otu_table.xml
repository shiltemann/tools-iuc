<tool id="qiime_make_otu_table" name="Make OTU table" version="@WRAPPER_VERSION@.0">

    <description>Make an OTU table from an OTU map and a taxonomy assignment file</description>

    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements"/>

    <version_command>make_otu_table.py --version</version_command>

    <command detect_errors="aggressive"><![CDATA[
        make_otu_table.py
            -i '$otu_map_fp'
            -o '$output_biom_fp'
            #if str($taxonomy) != 'None':
             -t '$taxonomy'
            #end if
            #if str($exclude_otus_fp) != 'None':
             -e '$exclude_otus_fp'
            #end if
    ]]></command>

    <inputs>
        <param argument="-i/--otu_map_fp" name="otu_map_fp" type="data" format="tabular,txt,biom" label="OTU map" help="An OTU map file generated by the pick_otus.py script" />
        <param argument="-t/--taxonomy" name="taxonomy" type="data" format="txt" optional="True" label="Taxonomy assignment" help="Text file generated by the assign_taxonomy.py script and contains the assignments of taxons to sequences" />
        <param argument="-e/--exclude_otus_fp" name="exclude_otus_fp" type="data" format="txt,fasta" optional="True" label="List of OTU identifiers to reject" help="A text file listing OTU identifiers that should not be included in the OTU table (generated by the identify_chimeric_seqs.py script) or a failure file in fasta format (generated by the align_seqs.py script)" />
        <param argument="-m/--mapping_fp" name="mapping_fp" type="data" format="tabular,txt" optional="True" label="Validated mapping file" help="A mapping file in tabular format verified by the validate_mapping_file.py script" />
    </inputs>

    <outputs>
        <data name="output_biom_fp" format="txt" label="${tool.name} on ${on_string}: otu_table.biom"/>
    </outputs>

    <tests>
        <test>
        </test>
    </tests>

    <help><![CDATA[
**What it does**

The script `make_otu_table.py <http://qiime.org/scripts/make_otu_table.html>`_ tabulates the number of times an OTU is found in each
sample, and adds the taxonomic predictions for each OTU in the last column if a taxonomy file is supplied.

The output of `make_otu_table.py <http://qiime.org/scripts/make_otu_table.html>`_ is a `biom file <http://biom-format.org/>`_, where the columns correspond to
Samples and rows correspond to OTUs and the number of times a sample appears in a particular OTU.

More information about this tool is available on
`QIIME documentation <http://qiime.org/scripts/make_otu_table.html>`_.
    ]]></help>

    <citations>
        <expand macro="citations"/>
    </citations>
</tool>
