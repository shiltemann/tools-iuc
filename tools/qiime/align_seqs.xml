<tool id="qiime_align_seqs" name="Align sequences" version="1.9.1">
    <description>using a variety of alignment methods</description>

    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements" />

    <version_command><![CDATA[
        align_seqs.py --version
    ]]>
    </version_command>

    <command>
<![CDATA[
        align_seqs.py 
            -i $input_fasta_fp
            -o align_seqs
            -m $alignment.alignment_method

            #if $alignment.alignment_method == 'pynast':
                -a $alignment.pairwise_alignment_method
            #end if

            #if str($template_fp) != 'None':
                -t $template_fp
            #end if

            #if $min_length:
                -e $min_length
            #end if

            -p $min_percent_id
]]>
    </command>

    <inputs>
        <param name="input_fasta_fp" type="data" format="fasta" 
            label="Input fasta file" help="(-i/--input_fasta_fp)"/> 

        <conditional name="alignment">
            <param name="alignment_method" type="select" 
                label="Method for aligning sequences" help="(-m/--alignment_method)">
                <option value="pynast" selected="True" >pynast</option>
                <option value="infernal" >infernal</option>
                <option value="clustalw" >clustalw</option>
                <option value="muscle" >muscle</option>
                <option value="mafft" >mafft</option>
            </param>
            <when value="pynast">
                <param name="pairwise_alignment_method" type="select" 
                    label="Method for performing pairwise alignment in PyNAST" 
                    help="(-a/--pairwise_alignment_method)">
                    <option value="muscle" >muscle</option>
                    <option value="pair_hmm" >pair_hmm</option>
                    <option value="clustal" >clustal</option>
                    <option value="blast" >blast</option>
                    <option value="uclust" >uclust</option>
                    <option value="mafft" >mafft</option>
                </param>
            </when>
            <when value="infernal" />
            <when value="clustalw" />
            <when value="muscle" />
            <when value="mafft" />
        </conditional>

        <param name="template_fp" type="data" format="fasta" 
            label="Fasta file for template alignmen" help="(-t/--template_fp)" 
            optional="True"/> 

        <param name="min_length" type="integer" label="Minimum sequence 
            length to include in alignment" help="By default, 75% of the median 
            input sequence length (-e/--min_length)" optional="True"/>

        <param name="min_percent_id" type="float" value="0.75" label="Minimum 
            percent sequence identity to closest blast hit to include sequence 
            in alignment" help="(-p/--min_percent_id)"/>
    </inputs>

    <outputs>
        <data name="aligned_sequences" format="fasta" 
            from_work_dir="align_seqs/*_aligned.fasta" 
            label="${tool.name} on ${on_string}: Aligned sequences" />

        <data name="failures_sequences" format="fasta" 
            from_work_dir="align_seqs/*_failures.fasta" 
            label="${tool.name} on ${on_string}: Failure sequences">
            <filter> alignment['alignment_method'] == 'pynast'</filter>
        </data>

        <data name="log" format="txt" from_work_dir="align_seqs/*_log.txt" 
            label="${tool.name} on ${on_string}: Log"/>
    </outputs>

    <tests>
        <test>
        </test>
    </tests>

    <help><![CDATA[

**What it does?**

This tool aligns the sequences in a FASTA file to each other or to a template sequence alignment, depending on the method chosen. 

More information about this tool is available on 
`QIIME documentation <http://qiime.org/scripts/align_seqs.html>`_.
    ]]>
    </help>

    <citations>
        <expand macro="citations" />
        <citation type="doi">10.1093/bioinformatics/btp636</citation>
        <citation type="doi">10.1093/nar/gkh340</citation>
        <citation type="doi">10.1093/bioinformatics/btp157</citation>
    </citations>
</tool>
