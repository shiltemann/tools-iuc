<tool id="qiime_beta_diversity_through_plots" name="Compute beta diversity distance 
    matrices" version="1.9.1">

    <description>and generate PCoA plots</description>

    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements" />

    <version_command><![CDATA[
        beta_diversity_through_plots.py --version
    ]]>
    </version_command>

    <stdio>
        <regex match="VisibleDeprecationWarning"
               source="both"
               level="warning"
               description="VisibleDeprecationWarning on numpy for `rank`" />
    </stdio>

    <command>
<![CDATA[  
        beta_diversity_through_plots.py 
            -i $otu_table_fp
            -m $mapping_fp
            -o beta_diversity_through_plots

            #if $tree_fp
                -t $tree_fp
            #end if

            #if $parameter_fp
                -p $parameter_fp
            #end if

            $parallel
            -O "\${GALAXY_SLOTS:-4}"

            #if $seqs_per_sample
                -e $seqs_per_sample
            #end if

            $suppress_emperor_plots

        &&

        python $__tool_directory__/beta_diversity_through_plots_html_generation.py 
            --data_directory beta_diversity_through_plots
            --html_file $beta_diversity_pcoa
            --html_dir $beta_diversity_pcoa.files_path     

    ]]>
    </command>

    <inputs>
        <param name="otu_table_fp" type="data" format="tabular,txt,tsv,biom" 
            label="OTU table" help="(-i/--otu_table_fp)" 
            multiple="True"/>

        <param name="mapping_fp" type="data" format="tabular,txt,tsv" 
            label="Mapping file" help="(-m/--mapping_fp)" 
            multiple="True"/>

        <param name="tree_fp" type="data" format="txt" 
            label="Tree file (Optional)" help="(-t/--tree_fp)" 
            optional="True"/>

        <param name="parameter_fp" type="data" format="txt" 
            label="Parameter file (Optional)" help="It specifies changes to the default 
            behavior, e.g. beta diversity metrics (-p/--parameter_fp)" 
            optional="true"/>

        <param name="color_by_all_fields" type="text" label="Colored mapping 
            fields" optional="True" help="Can be included only fields with 
            greater than one value and fewer values than the number of samples
            (--color_by_all_fields)" />

        <param name="parallel" type="boolean" label="Run in parallel where 
            available?" truevalue="--parallel" falsevalue="" checked="False" 
            help="(-a, --parallel)" />

        <param name="seqs_per_sample" type="integer" label="Depth of coverage for 
            even sampling (Optional)" help="(-e/--seqs_per_sample)" optional="True"/>

        <param name="suppress_emperor_plots" type="boolean" label="Generate 
            emperor plots?" truevalue="" falsevalue="--suppress_emperor_plots" checked="True" 
            help="(--suppress_emperor_plots)" />

    </inputs>

    <outputs>
        <data format="txt" name="beta_diversity_matrix">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)_dm\.txt" ext="txt" 
                directory="beta_diversity_through_plots" visible="true" />
        </data>

        <data format="txt" name="beta_diversity_pc">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)_pc\.txt" ext="txt" 
                directory="beta_diversity_through_plots" visible="true" />
        </data>

        <data format="html" name="beta_diversity_pcoa" 
            label="${tool.name} on ${on_string}: PCoA"/>
    </outputs>

    <tests>
        <test>
        </test>
    </tests>

    <help><![CDATA[
**What it does**

This tool computes beta diversity distance matrices and generates PCoA plots in
several steps

    - Performs beta diversity analysis
    - Performs principal coordinate analysis
    - Generates 3D PCoA Plots

More information about this tool is available on 
`QIIME documentation <http://qiime.org/scripts/beta_diversity_through_plots.html>`_.
    ]]>
    </help>

    <citations>
        <expand macro="citations" />
    </citations>
</tool>
